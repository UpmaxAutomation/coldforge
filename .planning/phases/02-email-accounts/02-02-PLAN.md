# Plan 02-02: Google Workspace OAuth Connection

## Objective
Implement Google OAuth flow for Gmail/Google Workspace account connection

## Context
- Users need to connect Gmail accounts via OAuth
- Requires Google Cloud Console setup (documented for user)
- Store OAuth tokens encrypted
- Use tokens for sending/receiving emails

## Tasks

<task type="auto">
  <name>Create Google OAuth routes</name>
  <files>src/app/api/auth/google/*.ts</files>
  <action>
    1. GET /api/auth/google - Initiate OAuth flow
    2. GET /api/auth/google/callback - Handle OAuth callback
    3. Store access_token, refresh_token encrypted
    4. Create email_account entry with provider='google'
  </action>
  <verify>OAuth flow redirects correctly</verify>
  <done>Google OAuth routes created</done>
</task>

<task type="auto">
  <name>Create Google OAuth client utilities</name>
  <files>src/lib/google.ts</files>
  <action>
    1. Create OAuth2 client initialization
    2. Token refresh logic
    3. Gmail API scopes configuration
    4. Send email via Gmail API function
    5. Fetch emails via Gmail API function
  </action>
  <verify>TypeScript compiles</verify>
  <done>Google utilities created</done>
</task>

<task type="auto">
  <name>Add Google connection button</name>
  <files>src/components/email-accounts/google-connect.tsx</files>
  <action>
    1. Create "Connect Google Account" button
    2. Handle OAuth redirect
    3. Show connection status
    4. Add to accounts page
  </action>
  <verify>Button triggers OAuth flow</verify>
  <done>Google connect button working</done>
</task>

## Success Criteria
- [ ] OAuth flow completes successfully
- [ ] Tokens stored encrypted
- [ ] Account appears in list after connection
