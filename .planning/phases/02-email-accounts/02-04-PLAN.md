# Plan 02-04: Generic SMTP/IMAP Connection

## Objective
Implement generic SMTP/IMAP connection for any email provider

## Context
- Users may use custom email providers
- Need SMTP for sending, IMAP for receiving
- Credentials must be encrypted
- Connection testing is critical

## Tasks

<task type="auto">
  <name>Create SMTP/IMAP connection form</name>
  <files>src/components/email-accounts/smtp-connect.tsx</files>
  <action>
    1. Create form with SMTP settings (host, port, user, pass, tls)
    2. Create form with IMAP settings (host, port, user, pass, tls)
    3. Add validation for required fields
    4. Add "Test Connection" button
  </action>
  <verify>Form renders and validates</verify>
  <done>SMTP/IMAP form created</done>
</task>

<task type="auto">
  <name>Create SMTP utilities</name>
  <files>src/lib/smtp.ts</files>
  <action>
    1. Create Nodemailer transporter factory
    2. Connection test function
    3. Send email function
    4. Handle common SMTP errors
  </action>
  <verify>TypeScript compiles</verify>
  <done>SMTP utilities created</done>
</task>

<task type="auto">
  <name>Create IMAP utilities</name>
  <files>src/lib/imap.ts</files>
  <action>
    1. Create IMAP client factory
    2. Connection test function
    3. Fetch emails function
    4. Handle common IMAP errors
  </action>
  <verify>TypeScript compiles</verify>
  <done>IMAP utilities created</done>
</task>

<task type="auto">
  <name>Create connection test API</name>
  <files>src/app/api/email-accounts/test/route.ts</files>
  <action>
    1. POST endpoint to test SMTP connection
    2. POST endpoint to test IMAP connection
    3. Return detailed error messages
    4. Support all provider types
  </action>
  <verify>API tests connections correctly</verify>
  <done>Test API working</done>
</task>

## Success Criteria
- [ ] SMTP credentials saved encrypted
- [ ] IMAP credentials saved encrypted
- [ ] Connection testing works
- [ ] Error messages are helpful
