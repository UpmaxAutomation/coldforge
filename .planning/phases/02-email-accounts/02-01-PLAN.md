# Plan 02-01: Email Accounts Schema and CRUD API

## Objective
Create database schema enhancements and API routes for email account management

## Context
- Database schema for email_accounts already exists from Phase 1
- Need to add encryption utilities for credentials
- Create API routes for CRUD operations
- Build email accounts list/detail UI components

## Tasks

<task type="auto">
  <name>Create encryption utilities</name>
  <files>src/lib/encryption.ts</files>
  <action>
    1. Create AES-256-GCM encryption for credentials
    2. Use environment variable for encryption key
    3. Export encrypt/decrypt functions
  </action>
  <verify>TypeScript compiles</verify>
  <done>Encryption utilities created</done>
</task>

<task type="auto">
  <name>Create email accounts API routes</name>
  <files>src/app/api/email-accounts/*.ts</files>
  <action>
    1. GET /api/email-accounts - List accounts for org
    2. POST /api/email-accounts - Create new account
    3. GET /api/email-accounts/[id] - Get single account
    4. PATCH /api/email-accounts/[id] - Update account
    5. DELETE /api/email-accounts/[id] - Delete account
    6. POST /api/email-accounts/[id]/test - Test connection
  </action>
  <verify>API routes respond correctly</verify>
  <done>All CRUD endpoints working</done>
</task>

<task type="auto">
  <name>Build email accounts UI</name>
  <files>src/app/(dashboard)/accounts/*.tsx, src/components/email-accounts/*.tsx</files>
  <action>
    1. Create accounts list component with cards
    2. Add account connection dialog
    3. Create account detail/edit view
    4. Add delete confirmation dialog
    5. Create test connection button with status
  </action>
  <verify>UI renders and interacts with API</verify>
  <done>Email accounts UI complete</done>
</task>

## Success Criteria
- [ ] Credentials encrypted at rest
- [ ] All CRUD operations working
- [ ] UI allows managing accounts
